(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{230:(e,t,r)=>{Promise.resolve().then(r.bind(r,2060))},542:()=>{},2060:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var n=r(5155),a=r(2115),l=r(1935);r(6368);var s=r(4787);let o=()=>{let[e,t]=(0,a.useState)({width:0,height:0}),[r,n]=(0,a.useState)(null),l=(0,a.useCallback)(e=>{null!==e&&n(e)},[]);return(0,a.useEffect)(()=>{if(!r)return;(()=>{let{width:e,height:n}=r.getBoundingClientRect();t({width:e,height:n})})();let e=new ResizeObserver(e=>{for(let r of e){let{width:e,height:n}=r.contentRect;t({width:e,height:n})}});return e.observe(r),()=>{e.disconnect()}},[r]),[l,e]},i=()=>{let[e,t]=(0,a.useState)({width:0,height:0}),[r,n]=(0,a.useState)(null),[l,s]=(0,a.useState)({width:0,height:0}),o=(0,a.useCallback)(e=>{null!==e&&n(e)},[]);return(0,a.useEffect)(()=>{let e=()=>{s({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,a.useEffect)(()=>{if(!r)return;(()=>{let{width:e,height:n}=r.getBoundingClientRect();t({width:e,height:n})})();let e=new ResizeObserver(e=>{for(let r of e){let{width:e,height:n}=r.contentRect;t({width:e,height:n})}});return e.observe(r),()=>{e.disconnect()}},[r]),(0,a.useEffect)(()=>{if(!r||0===e.width||0===e.height)return;let t=l.width-320,n=l.height/e.height,a=e.width*n;a>t?(r.style.width="100%",r.style.marginLeft="auto",r.style.marginRight="auto"):r.style.width="".concat(a,"px")},[l,e]),[o,e]};var c=r(2651);let d=(e,t)=>{let[r,n]=(0,a.useState)({data:null,loading:!0,error:null}),l=async()=>{if(e)try{n(e=>({...e,loading:!0}));let{data:r}=await (0,c.A)({method:"post",url:e,data:{action:"load",id:t},headers:{"Content-Type":"application/json"}});n({data:r,loading:!1,error:null}),console.log(r)}catch(e){n({data:null,loading:!1,error:e})}finally{n(e=>({...e,loading:!1}))}};return(0,a.useEffect)(()=>{l()},[e]),{...r,handleFetch:l}},u=(e,t)=>{let[r,n]=(0,a.useState)({data:null,loading:!0,error:null,success:!1});return[async(r,a)=>{if(e)try{n(e=>({...e,loading:!0,success:!1}));let l={action:"save",id:t,lastUpdated:Date.now(),comments:[...a.comments,r]},{data:s}=await (0,c.A)({method:"post",url:e,data:l,headers:{"Content-Type":"application/json"}});n({data:s,loading:!1,error:null,success:!0})}catch(e){n({data:null,loading:!1,error:e,success:!1})}finally{n(e=>({...e,loading:!1}))}},{...r}]},h=(e,t)=>{let[r,n]=(0,a.useState)({data:null,loading:!0,error:null,success:!1});return[async(r,a)=>{if(e)try{n(e=>({...e,loading:!0,success:!1}));let a={action:"save",id:t,lastUpdated:Date.now(),comments:r},{data:l}=await (0,c.A)({method:"post",url:e,data:a,headers:{"Content-Type":"application/json"}});n({data:l,loading:!1,error:null,success:!0})}catch(e){n({data:null,loading:!1,error:e,success:!1})}finally{n(e=>({...e,loading:!1}))}},{...r}]},g=(e,t)=>{let[r,n]=(0,a.useState)({data:null,loading:!0,error:null,success:!1});return[async(r,a)=>{if(e)try{n(e=>({...e,loading:!0,success:!1}));let l={action:"save",id:t,lastUpdated:Date.now(),status:r,comments:a},{data:s}=await (0,c.A)({method:"post",url:e,data:l,headers:{"Content-Type":"application/json"}});n({data:s,loading:!1,error:null,success:!0})}catch(e){n({data:null,loading:!1,error:e,success:!1})}finally{n(e=>({...e,loading:!1}))}},{...r}]},m={no_status:{label:"No Status",color:"gray",bgColor:"bg-gray-500/50",textColor:"text-gray-200"},in_progress:{label:"In Progress",color:"blue",bgColor:"bg-blue-500/50",textColor:"text-blue-200"},needs_review:{label:"Needs Review",color:"orange",bgColor:"bg-orange-500/50",textColor:"text-orange-200"},approved:{label:"Approved",color:"green",bgColor:"bg-green-500/50",textColor:"text-green-200"}},x=()=>{var e,t;let[r,c]=(0,a.useState)(""),[x,p]=(0,a.useState)([]),[f,w]=(0,a.useState)(!0),[v,b]=(0,a.useState)(""),[y,j]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[E,D]=(0,a.useState)(!1),[R,z]=(0,a.useState)("no_status"),M=(0,a.useRef)(null),_=(0,a.useRef)(null),T=(0,a.useRef)(null),W=(0,a.useRef)(null),A=(0,a.useRef)(()=>{}),[L,O]=(0,a.useState)(null),[H,B]=o(),[I,q]=i(),P=(0,a.useRef)(null),[U,V]=(0,a.useState)(()=>{{let e=new URLSearchParams(window.location.search);return{webhook_url:e.get("webhook_url"),id:e.get("id")}}}),{data:X,loading:Y,error:F,handleFetch:J}=d(U.webhook_url,U.id),[K,{data:G,loading:Q,error:Z,success:$}]=u(U.webhook_url,U.id),[ee,{data:et,loading:er,error:en,success:ea}]=h(U.webhook_url,U.id),[el,{data:es,loading:eo,error:ei,success:ec}]=g(U.webhook_url,U.id);(0,a.useEffect)(()=>{X&&f&&w(!1)},[X]),(0,a.useEffect)(()=>{X&&p(X.comments)},[X]),(0,a.useEffect)(()=>{$&&(p(X.comments),J())},[$]),(0,a.useEffect)(()=>{ea&&(p(X.comments),J())},[ea]),(0,a.useEffect)(()=>{ec&&(z(X.status),J())},[ec]),(0,a.useEffect)(()=>{if(X&&M.current&&!_.current){_.current=(0,l.A)(M.current,{controls:!0,fluid:!0});let e=_.current;e.on("play",()=>{if(W.current){W.current.clear();let e=document.querySelector(".canvas-container");e&&(e.style.display="none")}}),e.on("seeking",()=>{}),e.src({src:null==X?void 0:X.video_url,type:"video/mp4"}),j(!0),T.current.width=B.width,T.current.height=B.height;try{if(T.current&&!W.current){let e=new s.Hl(T.current);W.current=e,O(e),e.freeDrawingBrush=new s.mW(e),e.freeDrawingBrush.width=4,e.freeDrawingBrush.color="#ff0000",e.isDrawingMode=!1,_.current.on("loadedmetadata",()=>{let t=_.current.el();t&&e&&(e.setDimensions({width:t.offsetWidth,height:t.offsetHeight},{cssOnly:!1}),e.renderAll());let r=document.querySelector(".canvas-container");r&&(r.style.display="none")})}}catch(e){console.error("Fabric canvas initialization error:",e)}}},[X]),(0,a.useEffect)(()=>{if(L){let e=L.width,t=L.height,r=B.width/e,n=B.height/t;L.setDimensions({width:B.width,height:B.height}),console.log(B.width),console.log(B.height),L.getObjects().forEach(e=>{let t=e.strokeWidth;e.left=e.left*r,e.top=e.top*n,e.scaleX=e.scaleX*r,e.scaleY=e.scaleY*n,e.strokeWidth=t/((r+n)/2),e.setCoords()}),L.renderAll()}},[B]);let ed=(e,t)=>{"Enter"===e.key&&t()},eu=(e,t,r)=>3600*e+60*t+r,eh=e=>{let t=new Date(0);return t.setSeconds(e),t.toISOString().substring(11,19)},eg=()=>{W.current&&(S(!C),W.current.isDrawingMode=!C,W.current.clear());let e=document.querySelector(".canvas-container");e&&(e.style.display=C?"none":"block");let t=document.querySelector(".canvi");t&&(t.style.pointerEvents=C?"none":"auto");let r=document.querySelector(".upper-canvas");r&&(r.style.pointerEvents=C?"none":"auto"),C||_.current.pause()},em=()=>{W.current&&W.current.clear()},ex=async(e,t)=>{try{await el(e,t),console.log("Status actualizado:",e)}catch(e){console.error("Error al guardar el estado:",e)}},ep=async()=>{if(!v||!_.current)return;let e=_.current.currentTime(),t=W.current?W.current.toJSON():null,r={id:Date.now(),text:v,timestamp:e,formattedTime:eh(e),drawing:t,canvasWidth:B.width,canvasHeight:B.height,commentDone:!1};await K(r,X),b(""),em(),P.current&&(P.current.style.height="auto"),C&&eg()},ef=e=>{let[t,r,n]=eh(e.timestamp).split(":");k({...e,editText:e.text,hours:t,minutes:r,seconds:n})},ew=(e,t)=>{k(r=>({...r,[e]:t}))},ev=async()=>{if(!N)return;let e=W.current?W.current.toJSON():null,t=parseInt(N.hours)||0,r=parseInt(N.minutes)||0,n=parseInt(N.seconds)||0,a=eu(t=Math.min(Math.max(t,0),23),r=Math.min(Math.max(r,0),59),n=Math.min(Math.max(n,0),59)),l=Date.now(),s={...N,id:l,text:N.editText,timestamp:a,formattedTime:eh(a),drawing:e,canvasWidth:B.width,canvasHeight:B.height};try{let e=x.map(e=>e.id===N.id?s:e);await ee(e,X),p(e),k(null),C&&eg()}catch(e){console.error("Error updating comments:",e)}},eb=async e=>{let t=x.map(t=>t.id===e?{...t,commentDone:!t.commentDone}:t);await ee(t,X),D(!0)},ey=async()=>{if(!N)return;C&&eg();let e=x.filter(e=>e.id!==N.id);await ee(e,X),em(),k(null)},ej=(e,t,r,n)=>{if(_.current){if(_.current.currentTime(e),W.current&&t){let a=document.querySelector(".canvas-container");_.current.el();let l=document.querySelector(".canvi"),s=document.querySelector(".upper-canvas");a&&(a.style.display="block",a.style.pointerEvents="none"),l&&s&&(l.style.pointerEvents="none",s.style.pointerEvents="none"),S(!1),W.current.clear(),L.loadFromJSON(t);let o=!1,i=()=>{if(.1>Math.abs(_.current.currentTime()-e)){if(a&&(a.style.display="block"),L&&!o){let e=B.width/r,t=B.height/n;L.getObjects().forEach(r=>{let n=r.strokeWidth;r.left=r.left*e,r.top=r.top*t,r.scaleX=r.scaleX*e,r.scaleY=r.scaleY*t,r.strokeWidth=n/((e+t)/2),r.setCoords()}),L.renderAll(),o=!0}}else a&&(a.style.display="none")};A.current&&_.current.off("timeupdate",A.current),_.current.on("timeupdate",i),A.current=i,_.current.pause()}else{var a;null===(a=W.current)||void 0===a||a.clear()}}};(0,a.useEffect)(()=>{let e=()=>{let e=new URLSearchParams(window.location.search);V({webhook_url:e.get("webhook_url"),id:e.get("id")})};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);let[eN,ek]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{X&&X.status&&z(X.status)},[X]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[(0,n.jsx)("div",{className:"flex-1 transition-all duration-300 ease-in-out \n          ".concat(eN?"lg:pr-80":"lg:pr-0","\n          ").concat(eN?"mb-[50vh]":"mb-0"," lg:mb-0\n        "),children:(0,n.jsxs)("div",{className:"container-principal w-[100%] flex flex-col justify-center ",ref:I,children:[(0,n.jsxs)("div",{className:"video-container relative w-full mt-4 ",ref:H,children:[(0,n.jsx)("video",{ref:M,className:"video-js  vjs-big-play-centered w-full   ",playsInline:!0,controls:!0}),(0,n.jsx)("canvas",{ref:T,className:"canvi absolute top-0 left-0 pointer-events-auto w-full h-full",style:{zIndex:1,width:"100%",height:"100%"}})]}),y&&(0,n.jsx)("div",{className:"  mt-4 w-full flex justify-center",children:(0,n.jsxs)("div",{className:"relative w-[600px] max-w-full",children:[(0,n.jsx)("textarea",{ref:P,className:"w-full bg-gray-800/50 backdrop-blur-sm text-white px-4 py-3 pr-40 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none min-h-[44px] max-h-[200px] resize-y md:text-sm text-base shadow-lg",value:v,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ep())},placeholder:"Add a comment...",style:{overflow:"hidden",lineHeight:"1.5",fontSize:"14px",WebkitTextSizeAdjust:"100%"},onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}}),(0,n.jsxs)("div",{className:"absolute right-2 top-2 flex gap-2",children:[(0,n.jsx)("button",{className:"p-1.5 rounded-md transition-all duration-200 ".concat(C?"bg-red-500 hover:bg-red-600":"bg-gray-600 hover:bg-gray-500"),onClick:eg,title:C?"Stop Drawing":"Start Drawing",children:C?(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 002 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M12 7a1 1 0 00-1 1v4a1 1 0 002 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})]}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M13.293 3.293a1 1 0 011.414 0l2 2a1 1 0 010 1.414l-9 9a1 1 0 01-.39.242l-3 1a1 1 0 01-1.266-1.265l1-3a1 1 0 01.242-.391l9-9zM14 4l2 2-9 9-3 1 1-3 9-9z",clipRule:"evenodd"})})}),(0,n.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md transition-all duration-200 text-sm",onClick:ep,children:"Add"})]})]})})]})}),!eN&&(0,n.jsx)("button",{onClick:()=>ek(e=>!e),className:"fixed z-50 bg-gray-800/50 backdrop-blur-sm p-2 rounded-full hover:bg-gray-700/50 transition-all duration-200 right-4 bottom-4 lg:top-4 lg:bottom-auto",title:eN?"Hide Comments":"Show Comments",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),(0,n.jsx)("div",{className:"fixed transition-all duration-300 ease-in-out\n          lg:w-80 w-full h-[min(50vh,300px)] lg:h-screen\n          lg:right-0 right-0\n          lg:top-0 bottom-0\n          bg-gray-800/50 backdrop-blur-sm\n          ".concat(eN?"translate-y-0 lg:translate-x-0":"translate-y-full lg:translate-x-full","\n        "),children:y&&(0,n.jsxs)("div",{className:"h-full p-4 flex flex-col",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("label",{className:"text-sm font-medium text-gray-200",children:"Video Status"})}),(0,n.jsx)("div",{className:"flex justify-end items-center",children:(0,n.jsx)("img",{src:"/logo.png",alt:"logo",className:"w-10 h-10"})})]}),(0,n.jsx)("select",{value:R,onChange:e=>{ex(e.target.value,x)},className:"w-full px-3 py-2 rounded-lg transition-colors duration-200 text-sm ".concat(null===(e=m[R])||void 0===e?void 0:e.bgColor," ").concat(null===(t=m[R])||void 0===t?void 0:t.textColor),style:{appearance:"none",backgroundImage:"url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center",backgroundSize:"1rem",paddingRight:"2.5rem"},children:Object.entries(m).map(e=>{let[t,{label:r,bgColor:a,textColor:l}]=e;return(0,n.jsx)("option",{value:t,className:"".concat(a," ").concat(l),style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r},t)})})]}),(0,n.jsx)("div",{className:"flex items-center gap-2 mb-4",children:(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-200 py-2",children:"Comments"})}),(0,n.jsx)("div",{className:"flex-grow overflow-y-auto space-y-2 text-sm scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent",children:(null==x?void 0:x.length)>0?x.map(e=>N&&N.id===e.id?(0,n.jsxs)("div",{className:"p-2.5 bg-gray-700/50 backdrop-blur-sm rounded-lg",children:[(0,n.jsxs)("div",{className:"flex gap-1 mb-2",children:[(0,n.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:N.hours,onChange:e=>ew("hours",e.target.value)}),":",(0,n.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:N.minutes,onChange:e=>ew("minutes",e.target.value)}),":",(0,n.jsx)("input",{type:"text",className:"border border-gray-400 p-1 w-10 text-center text-white",value:N.seconds,onChange:e=>ew("seconds",e.target.value)})]}),(0,n.jsx)("input",{type:"text",className:"border border-gray-400 p-2 w-full text-white",value:N.editText,onChange:e=>k({...N,editText:e.target.value}),onKeyPress:e=>ed(e,ev)}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)("button",{className:"bg-green-500 text-white px-4 py-1",onClick:ev,children:"Save"}),(0,n.jsx)("button",{className:"bg-gray-500 text-white px-4 py-1",onClick:()=>{k(null),C&&eg()},children:"Cancel"}),(0,n.jsx)("button",{className:"bg-red-500 text-white px-4 py-1",onClick:ey,children:"Delete"})]})]},e.id):(0,n.jsxs)("div",{className:"p-2.5 bg-gray-700/50 backdrop-blur-sm rounded-lg hover:bg-gray-600/50 transition-all duration-200",onClick:()=>ej(e.timestamp,e.drawing,e.canvasWidth,e.canvasHeight),children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsx)("button",{onClick:()=>eb(e.id),className:"relative w-4 h-4 flex items-center justify-center",children:(0,n.jsx)("div",{className:"\n                                w-4 h-4 border-2 rounded \n                                transition-all duration-200 ease-in-out\n                                ".concat(e.commentDone?"border-green-500 bg-green-500":"border-gray-400 bg-transparent","\n                              "),children:e.commentDone&&(0,n.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})}),(0,n.jsx)("span",{className:"text-blue-400 cursor-pointer hover:text-blue-300 text-xs ".concat(e.commentDone?"line-through text-gray-400":""),onClick:()=>ej(e.timestamp,e.drawing,e.canvasWidth,e.canvasHeight),children:e.formattedTime})]}),(0,n.jsx)("button",{className:"text-gray-400 hover:text-white transition-colors duration-200 text-xs",onClick:()=>ef(e),children:"✏️"})]}),(0,n.jsx)("div",{className:"text-gray-200 break-words text-xs pl-6 ".concat(e.commentDone?"line-through text-gray-400":""),children:e.text})]},e.id)):(0,n.jsx)("p",{className:"text-gray-400 text-center py-4 text-xs",children:"No comments yet"})})]})})]}),f&&(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-900 z-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("img",{src:"/logo.png",alt:"logo",className:"w-20 h-20 animate-pulse"}),(0,n.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[953,776,742,821,441,587,358],()=>t(230)),_N_E=e.O()}]);